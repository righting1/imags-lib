<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rightings.backed.mapper.PictureMapper">

    <resultMap id="BaseResultMap" type="com.rightings.backed.model.entity.Picture">
            <id property="id" column="id" jdbcType="BIGINT"/>
            <result property="url" column="url" jdbcType="VARCHAR"/>
            <result property="thumbnailUrl" column="thumbnailUrl" jdbcType="VARCHAR"/>
            <result property="name" column="name" jdbcType="VARCHAR"/>
            <result property="introduction" column="introduction" jdbcType="VARCHAR"/>
            <result property="category" column="category" jdbcType="VARCHAR"/>
            <result property="tags" column="tags" jdbcType="VARCHAR"/>
            <result property="picSize" column="picSize" jdbcType="BIGINT"/>
            <result property="picWidth" column="picWidth" jdbcType="INTEGER"/>
            <result property="picHeight" column="picHeight" jdbcType="INTEGER"/>
            <result property="picScale" column="picScale" jdbcType="DOUBLE"/>
            <result property="picFormat" column="picFormat" jdbcType="VARCHAR"/>
            <result property="picColor" column="picColor" jdbcType="VARCHAR"/>
            <result property="userId" column="userId" jdbcType="BIGINT"/>
            <result property="spaceId" column="spaceId" jdbcType="BIGINT"/>
            <result property="createTime" column="createTime" jdbcType="TIMESTAMP"/>
            <result property="editTime" column="editTime" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="updateTime" jdbcType="TIMESTAMP"/>
            <result property="isDelete" column="isDelete" jdbcType="TINYINT"/>
            <result property="reviewStatus" column="reviewStatus" jdbcType="INTEGER"/>
            <result property="reviewMessage" column="reviewMessage" jdbcType="VARCHAR"/>
            <result property="reviewerId" column="reviewerId" jdbcType="BIGINT"/>
            <result property="reviewTime" column="reviewTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,url,thumbnailUrl,name,
        introduction,category,tags,
        picSize,picWidth,picHeight,
        picScale,picFormat,userId,spaceId,
        createTime,editTime,updateTime,
        isDelete,reviewStatus,reviewMessage,
        reviewerId,reviewTime
    </sql>



    <!-- 查询符合条件的分页数据 -->
    <select id="selectPageByCondition" resultType="com.rightings.backed.model.vo.PictureVO">
        SELECT
        p.id,
        p.url,
        p.name,
        p.introduction,
        p.category,
        p.tags,
        p.picSize,
        p.picWidth,
        p.picHeight,
        p.picScale,
        p.picFormat,
        p.userId,
        p.createTime,
        p.editTime,
        p.updateTime,
        p.isDelete,
        p.reviewStatus,
        p.reviewMessage,
        p.reviewerId,
        p.reviewTime,
        p.thumbnailUrl,
        p.spaceId,
        p.picColor,
        p.likeCount
        FROM
        picture p
        WHERE
        1=1
        <if test="query.id != null">AND p.id = #{query.id}</if>
        <if test="query.name != null">AND p.name LIKE CONCAT('%', #{query.name}, '%')</if>
        <if test="query.introduction != null">AND p.introduction LIKE CONCAT('%', #{query.introduction}, '%')</if>
        <if test="query.category != null">AND p.category = #{query.category}</if>

        <if test="query.tags != null and query.tags.size() > 0">
            AND
            <foreach collection="query.tags" item="tag" separator="AND">
                 p.tags LIKE CONCAT('%', #{tag}, '%') <!-- 对每个标签进行LIKE查询 -->
            </foreach>
        </if>

        <if test="query.picSize != null">AND p.picSize = #{query.picSize}</if>
        <if test="query.picWidth != null">AND p.picWidth = #{query.picWidth}</if>
        <if test="query.picHeight != null">AND p.picHeight = #{query.picHeight}</if>
        <if test="query.picScale != null">AND p.picScale = #{query.picScale}</if>
        <if test="query.picFormat != null">AND p.picFormat = #{query.picFormat}</if>
        <if test="query.userId != null">AND p.userId = #{query.userId}</if>
        <if test="query.reviewStatus != null">AND p.reviewStatus = #{query.reviewStatus}</if>
        <if test="query.spaceId != null">AND p.spaceId = #{query.spaceId}</if>
        <if test="query.nullSpaceId != null and query.nullSpaceId == true">AND p.spaceId IS NULL</if>
        <if test="query.startEditTime != null">AND p.editTime &gt;= #{query.startEditTime}</if>
        <if test="query.endEditTime != null">AND p.editTime &lt;= #{query.endEditTime}</if>

        <!-- 排序 -->
        <if test="query.sortField != null and query.sortOrder != null">
            ORDER BY
            <choose>
                <when test="query.sortField == 'createTime'">p.createTime</when>
                <when test="query.sortField == 'name'">p.name</when>
                <when test="query.sortField == 'picSize'">p.picSize</when>
                <!-- 可以根据其他排序字段继续添加 -->
                <otherwise>p.createTime</otherwise> <!-- 默认排序字段 -->
            </choose>

            <choose>
                <when test="query.sortOrder == 'ascend'">ASC</when>
                <when test="query.sortOrder == 'descend'">DESC</when>
                <otherwise>DESC</otherwise> <!-- 默认排序方式 -->
            </choose>
        </if>

    </select>

</mapper>
